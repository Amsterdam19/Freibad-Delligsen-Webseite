var e=require("@swup/plugin"),t=require("swup");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=/*#__PURE__*/s(e);module.exports=class extends r.default{constructor(e){void 0===e&&(e={}),super(),this.name="SwupFormsPlugin",this.requires={swup:">=4"},this.defaults={formSelector:"form[data-swup-form]"},this.options=void 0,this.specialKeys={Meta:!1,Control:!1,Shift:!1},this.formSubmitDelegate=void 0,this.onKeyDown=e=>{this.specialKeys.hasOwnProperty(e.key)&&(this.specialKeys[e.key]=!0)},this.onKeyUp=e=>{this.specialKeys.hasOwnProperty(e.key)&&(this.specialKeys[e.key]=!1)},this.options={...this.defaults,...e}}mount(){this.swup.hooks.create("form:submit"),this.swup.hooks.create("form:submit:newtab"),this.formSubmitDelegate=this.swup.delegateEvent(this.options.formSelector,"submit",this.beforeFormSubmit.bind(this),{capture:!0}),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}unmount(){this.formSubmitDelegate?.destroy(),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}beforeFormSubmit(e){const s=this.swup,r=e.delegateTarget,o=r.getAttribute("action")||t.getCurrentUrl(),i=this.isSpecialKeyPressed(),a="_blank"===r.getAttribute("target");if(i||a||!s.shouldIgnoreVisit(o,{el:r,event:e})){if(!a)return i?(s.hooks.callSync("form:submit:newtab",{el:r,event:e}),r.dataset.swupOriginalFormTarget=r.getAttribute("target")||"",r.setAttribute("target","_blank"),void r.addEventListener("submit",()=>requestAnimationFrame(()=>this.restorePreviousFormTarget(r)),{once:!0})):void s.hooks.callSync("form:submit",{el:r,event:e},()=>{this.submitForm(e)});s.hooks.callSync("form:submit:newtab",{el:r,event:e})}}restorePreviousFormTarget(e){e.dataset.swupOriginalFormTarget?e.setAttribute("target",e.dataset.swupOriginalFormTarget):e.removeAttribute("target")}submitForm(e){const t=e.delegateTarget,{url:s,hash:r,method:o,data:i,body:a}=this.getFormInfo(t);let n=s,u={method:o};switch(o){case"POST":u={method:o,body:a};break;case"GET":n=this.appendQueryParams(n,i);break;default:return void console.warn(`Unsupported form method: ${o}`)}e.preventDefault(),this.swup.cache.delete(n),this.swup.navigate(n+r,u,{el:t,event:e})}getFormInfo(e){const s=e.getAttribute("action")||t.getCurrentUrl(),{url:r,hash:o}=t.Location.fromUrl(s),i=(e.getAttribute("method")||"get").toUpperCase(),a=(e.getAttribute("enctype")||"application/x-www-form-urlencoded").toLowerCase(),n="multipart/form-data"===a,u=new FormData(e);let m=u;return n||(m=new URLSearchParams(u)),{url:r,hash:o,method:i,data:u,body:m,encoding:a}}appendQueryParams(e,t){const s=e.split("?")[0],r=new URLSearchParams(t).toString();return r?`${s}?${r}`:s}isSpecialKeyPressed(){return Object.values(this.specialKeys).some(e=>e)}resetSpecialKeys(){for(const e of Object.keys(this.specialKeys))this.specialKeys[e]=!1}};
//# sourceMappingURL=index.cjs.map
