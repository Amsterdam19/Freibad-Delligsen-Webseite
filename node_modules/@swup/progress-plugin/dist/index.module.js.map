{"version":3,"file":"index.module.js","sources":["../src/ProgressBar.ts","../src/index.ts"],"sourcesContent":["export default class ProgressBar {\n\tvalue: number = 0;\n\tvisible: boolean = false;\n\thiding: boolean = false;\n\n\tclassName: string = 'progress-bar';\n\tstyleAttr: string = 'data-progressbar-styles data-swup-theme';\n\tanimationDuration: number = 300;\n\tminValue: number = 0.1;\n\tinitialValue: number = 0.25;\n\ttrickleValue: number = 0.03;\n\ttrickleInterval?: number;\n\n\tstyleElement: HTMLStyleElement;\n\tprogressElement: HTMLDivElement;\n\n\tconstructor({\n\t\tclassName,\n\t\tstyleAttr,\n\t\tanimationDuration,\n\t\tminValue,\n\t\tinitialValue,\n\t\ttrickleValue\n\t}: {\n\t\tclassName?: string;\n\t\tstyleAttr?: string;\n\t\tanimationDuration?: number;\n\t\tminValue?: number;\n\t\tinitialValue?: number;\n\t\ttrickleValue?: number;\n\t} = {}) {\n\t\tif (className !== undefined) {\n\t\t\tthis.className = String(className);\n\t\t}\n\t\tif (styleAttr !== undefined) {\n\t\t\tthis.styleAttr = String(styleAttr);\n\t\t}\n\t\tif (animationDuration !== undefined) {\n\t\t\tthis.animationDuration = Number(animationDuration);\n\t\t}\n\t\tif (minValue !== undefined) {\n\t\t\tthis.minValue = Number(minValue);\n\t\t}\n\t\tif (initialValue !== undefined) {\n\t\t\tthis.initialValue = Number(initialValue);\n\t\t}\n\t\tif (trickleValue !== undefined) {\n\t\t\tthis.trickleValue = Number(trickleValue);\n\t\t}\n\n\t\tthis.styleElement = this.createStyleElement();\n\t\tthis.progressElement = this.createProgressElement();\n\t}\n\n\tget defaultStyles(): string {\n\t\treturn `\n\t\t.${this.className} {\n\t\t\tposition: fixed;\n\t\t\tdisplay: block;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\theight: 3px;\n\t\t\tbackground-color: black;\n\t\t\tz-index: 9999;\n\t\t\ttransition:\n\t\t\t\twidth ${this.animationDuration}ms ease-out,\n\t\t\t\topacity ${this.animationDuration / 2}ms ${this.animationDuration / 2}ms ease-in;\n\t\t\ttransform: translate3d(0, 0, 0);\n\t\t}\n\t`;\n\t}\n\n\tshow(): void {\n\t\tif (!this.visible) {\n\t\t\tthis.visible = true;\n\t\t\tthis.installStyleElement();\n\t\t\tthis.installProgressElement();\n\t\t\tthis.startTrickling();\n\t\t}\n\t}\n\n\thide(): void {\n\t\tif (this.visible && !this.hiding) {\n\t\t\tthis.hiding = true;\n\t\t\tthis.fadeProgressElement(() => {\n\t\t\t\tthis.uninstallProgressElement();\n\t\t\t\tthis.stopTrickling();\n\t\t\t\tthis.visible = false;\n\t\t\t\tthis.hiding = false;\n\t\t\t});\n\t\t}\n\t}\n\n\tsetValue(value: number): void {\n\t\tthis.value = Math.min(1, Math.max(this.minValue, value));\n\t\tthis.refresh();\n\t}\n\n\tprivate installStyleElement(): void {\n\t\tdocument.head.insertBefore(this.styleElement!, document.head.firstChild);\n\t}\n\n\tprivate installProgressElement(): void {\n\t\tthis.progressElement.style.width = '0%';\n\t\tthis.progressElement.style.opacity = '1';\n\t\tdocument.documentElement.insertBefore(this.progressElement!, document.body);\n\t\tthis.progressElement.scrollTop = 0; // Force reflow to ensure the initial style takes effect\n\t\tthis.setValue(Math.random() * this.initialValue);\n\t}\n\n\tprivate fadeProgressElement(callback: () => void): void {\n\t\tthis.progressElement.style.opacity = '0';\n\t\tsetTimeout(callback, this.animationDuration * 1.5);\n\t}\n\n\tprivate uninstallProgressElement(): void {\n\t\tif (this.progressElement.parentNode) {\n\t\t\tdocument.documentElement.removeChild(this.progressElement!);\n\t\t}\n\t}\n\n\tprivate startTrickling(): void {\n\t\tif (!this.trickleInterval) {\n\t\t\tthis.trickleInterval = window.setInterval(this.trickle, this.animationDuration);\n\t\t}\n\t}\n\n\tprivate stopTrickling(): void {\n\t\twindow.clearInterval(this.trickleInterval);\n\t\tdelete this.trickleInterval;\n\t}\n\n\tprivate trickle = (): void => {\n\t\tconst advance = Math.random() * this.trickleValue;\n\t\tthis.setValue(this.value + advance);\n\t};\n\n\tprivate refresh(): void {\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.progressElement.style.width = `${this.value * 100}%`;\n\t\t});\n\t}\n\n\tprivate createStyleElement(): HTMLStyleElement {\n\t\tconst element = document.createElement('style');\n\t\tthis.styleAttr.split(' ').forEach((attr) => element.setAttribute(attr, ''));\n\t\telement.textContent = this.defaultStyles;\n\t\treturn element;\n\t}\n\n\tprivate createProgressElement(): HTMLDivElement {\n\t\tconst element = document.createElement('div');\n\t\telement.className = this.className;\n\t\treturn element;\n\t}\n}\n","import Plugin from '@swup/plugin';\nimport ProgressBar from './ProgressBar.js';\n\ntype Options = {\n\tclassName: string;\n\tdelay: number;\n\ttransition: number;\n\tminValue: number;\n\tinitialValue: number;\n\tfinishAnimation: boolean;\n};\n\nexport default class SwupProgressPlugin extends Plugin {\n\tname = 'SwupProgressPlugin';\n\n\tdefaults: Options = {\n\t\tclassName: 'swup-progress-bar',\n\t\tdelay: 300,\n\t\ttransition: 300,\n\t\tminValue: 0.1,\n\t\tinitialValue: 0.25,\n\t\tfinishAnimation: true\n\t};\n\toptions: Options;\n\n\tprogressBar: ProgressBar;\n\tshowProgressBarTimeout?: number;\n\thideProgressBarTimeout?: number;\n\n\tconstructor(options: Partial<Options> = {}) {\n\t\tsuper();\n\t\tthis.options = { ...this.defaults, ...options };\n\t\tconst { className, minValue, initialValue, transition: animationDuration } = this.options;\n\t\tthis.progressBar = new ProgressBar({\n\t\t\tclassName,\n\t\t\tminValue,\n\t\t\tinitialValue,\n\t\t\tanimationDuration\n\t\t});\n\t}\n\n\tmount() {\n\t\tthis.on('visit:start', this.startShowingProgress);\n\t\tthis.on('page:view', this.stopShowingProgress);\n\t}\n\n\tstartShowingProgress() {\n\t\tthis.progressBar.setValue(0);\n\t\tthis.showProgressBarAfterDelay();\n\t}\n\n\tstopShowingProgress() {\n\t\tthis.progressBar.setValue(1);\n\t\tif (this.options.finishAnimation) {\n\t\t\tthis.finishAnimationAndHideProgressBar();\n\t\t} else {\n\t\t\tthis.hideProgressBar();\n\t\t}\n\t}\n\n\tshowProgressBar() {\n\t\tthis.cancelHideProgressBarTimeout();\n\t\tthis.progressBar.show();\n\t}\n\n\tshowProgressBarAfterDelay() {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.cancelHideProgressBarTimeout();\n\t\tthis.showProgressBarTimeout = window.setTimeout(\n\t\t\tthis.showProgressBar.bind(this),\n\t\t\tthis.options.delay\n\t\t);\n\t}\n\n\thideProgressBar() {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.progressBar.hide();\n\t}\n\n\tfinishAnimationAndHideProgressBar() {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.hideProgressBarTimeout = window.setTimeout(\n\t\t\tthis.hideProgressBar.bind(this),\n\t\t\tthis.options.transition\n\t\t);\n\t}\n\n\tcancelShowProgressBarTimeout() {\n\t\twindow.clearTimeout(this.showProgressBarTimeout);\n\t\tdelete this.showProgressBarTimeout;\n\t}\n\n\tcancelHideProgressBarTimeout() {\n\t\twindow.clearTimeout(this.hideProgressBarTimeout);\n\t\tdelete this.hideProgressBarTimeout;\n\t}\n}\n"],"names":["ProgressBar","constructor","_temp","className","styleAttr","animationDuration","minValue","initialValue","trickleValue","this","value","visible","hiding","trickleInterval","styleElement","progressElement","trickle","advance","Math","random","setValue","undefined","String","Number","createStyleElement","createProgressElement","defaultStyles","show","installStyleElement","installProgressElement","startTrickling","hide","fadeProgressElement","uninstallProgressElement","stopTrickling","min","max","refresh","document","head","insertBefore","firstChild","style","width","opacity","documentElement","body","scrollTop","callback","setTimeout","parentNode","removeChild","window","setInterval","clearInterval","requestAnimationFrame","element","createElement","split","forEach","attr","setAttribute","textContent","SwupProgressPlugin","Plugin","options","super","name","defaults","delay","transition","finishAnimation","progressBar","showProgressBarTimeout","hideProgressBarTimeout","mount","on","startShowingProgress","stopShowingProgress","showProgressBarAfterDelay","finishAnimationAndHideProgressBar","hideProgressBar","showProgressBar","cancelHideProgressBarTimeout","cancelShowProgressBarTimeout","bind","clearTimeout"],"mappings":"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"}