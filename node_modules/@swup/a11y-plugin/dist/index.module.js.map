{"version":3,"file":"index.module.js","sources":["../src/index.ts"],"sourcesContent":["import Plugin from '@swup/plugin';\nimport OnDemandLiveRegion from 'on-demand-live-region';\n\nimport 'focus-options-polyfill';\n\ntype Options = {\n\t/** The selector for matching the main content area of the page. */\n\tcontentSelector: string;\n\t/** The selector for finding headings inside the main content area. */\n\theadingSelector: string;\n\t/** How to announce the new page title. */\n\tannouncementTemplate: string;\n\t/** How to announce the new page url. Used as fallback if no heading was found. */\n\turlTemplate: string;\n};\n\nexport default class SwupA11yPlugin extends Plugin {\n\tname = 'SwupA11yPlugin';\n\n\trequires = { swup: '>=4' };\n\n\tdefaults: Options = {\n\t\tcontentSelector: 'main',\n\t\theadingSelector: 'h1, h2, [role=heading]',\n\t\tannouncementTemplate: 'Navigated to: {title}',\n\t\turlTemplate: 'New page at {url}'\n\t};\n\n\toptions: Options;\n\n\tliveRegion: OnDemandLiveRegion;\n\n\tconstructor(options: Partial<Options> = {}) {\n\t\tsuper();\n\t\tthis.options = { ...this.defaults, ...options };\n\t\tthis.liveRegion = new OnDemandLiveRegion();\n\t}\n\n\tmount() {\n\t\tthis.on('visit:start', this.markAsBusy);\n\t\tthis.on('visit:end', this.unmarkAsBusy);\n\t\tthis.on('content:replace', this.announceVisit);\n\t}\n\n\tmarkAsBusy() {\n\t\tdocument.documentElement.setAttribute('aria-busy', 'true');\n\t}\n\n\tunmarkAsBusy() {\n\t\tdocument.documentElement.removeAttribute('aria-busy');\n\t}\n\n\tannounceVisit() {\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.announcePageName();\n\t\t\tthis.focusPageContent();\n\t\t});\n\t}\n\n\tannouncePageName() {\n\t\tconst { contentSelector, headingSelector, urlTemplate, announcementTemplate } =\n\t\t\tthis.options;\n\n\t\t// Default: announce new /path/of/page.html\n\t\tlet pageName: string = urlTemplate.replace('{url}', window.location.pathname);\n\n\t\t// Check for title tag\n\t\tif (document.title) {\n\t\t\tpageName = document.title;\n\t\t}\n\n\t\t// Look for first heading in content container\n\t\tconst content = document.querySelector(contentSelector);\n\t\tif (content) {\n\t\t\tconst headings = content.querySelectorAll(headingSelector);\n\t\t\tif (headings && headings.length) {\n\t\t\t\tconst [heading] = headings;\n\t\t\t\tpageName = heading.getAttribute('aria-label') || heading.textContent || pageName;\n\t\t\t}\n\t\t}\n\n\t\tconst announcement = announcementTemplate.replace('{title}', pageName.trim());\n\t\tthis.liveRegion.say(announcement);\n\t}\n\n\tfocusPageContent() {\n\t\tconst content = document.querySelector<HTMLElement>(this.options.contentSelector);\n\t\tif (content) {\n\t\t\tcontent.setAttribute('tabindex', '-1');\n\t\t\tcontent.focus({ preventScroll: true });\n\t\t}\n\t}\n}\n"],"names":["SwupA11yPlugin","Plugin","constructor","options","super","this","name","requires","swup","defaults","contentSelector","headingSelector","announcementTemplate","urlTemplate","liveRegion","OnDemandLiveRegion","mount","on","markAsBusy","unmarkAsBusy","announceVisit","document","documentElement","setAttribute","removeAttribute","requestAnimationFrame","announcePageName","focusPageContent","pageName","replace","window","location","pathname","title","content","querySelector","headings","querySelectorAll","length","heading","getAttribute","textContent","announcement","trim","say","focus","preventScroll"],"mappings":"gGAgBqB,MAAAA,UAAuBC,EAgB3CC,WAAAA,CAAYC,YAAAA,IAAAA,EAA4B,CAAA,GACvCC,QAAQC,KAhBTC,KAAO,iBAAgBD,KAEvBE,SAAW,CAAEC,KAAM,OAAOH,KAE1BI,SAAoB,CACnBC,gBAAiB,OACjBC,gBAAiB,yBACjBC,qBAAsB,wBACtBC,YAAa,0BAGdV,aAAO,EAAAE,KAEPS,gBAIC,EAAAT,KAAKF,QAAU,IAAKE,KAAKI,YAAaN,GACtCE,KAAKS,WAAa,IAAIC,CACvB,CAEAC,KAAAA,GACCX,KAAKY,GAAG,cAAeZ,KAAKa,YAC5Bb,KAAKY,GAAG,YAAaZ,KAAKc,cAC1Bd,KAAKY,GAAG,kBAAmBZ,KAAKe,cACjC,CAEAF,UAAAA,GACCG,SAASC,gBAAgBC,aAAa,YAAa,OACpD,CAEAJ,YAAAA,GACCE,SAASC,gBAAgBE,gBAAgB,YAC1C,CAEAJ,aAAAA,GACCK,sBAAsB,KACrBpB,KAAKqB,mBACLrB,KAAKsB,oBAEP,CAEAD,gBAAAA,GACC,MAAMhB,gBAAEA,EAAeC,gBAAEA,EAAeE,YAAEA,EAAWD,qBAAEA,GACtDP,KAAKF,QAGN,IAAIyB,EAAmBf,EAAYgB,QAAQ,QAASC,OAAOC,SAASC,UAGhEX,SAASY,QACZL,EAAWP,SAASY,OAIrB,MAAMC,EAAUb,SAASc,cAAczB,GACvC,GAAIwB,EAAS,CACZ,MAAME,EAAWF,EAAQG,iBAAiB1B,GAC1C,GAAIyB,GAAYA,EAASE,OAAQ,CAChC,MAAOC,GAAWH,EAClBR,EAAWW,EAAQC,aAAa,eAAiBD,EAAQE,aAAeb,CACxE,CACD,CAED,MAAMc,EAAe9B,EAAqBiB,QAAQ,UAAWD,EAASe,QACtEtC,KAAKS,WAAW8B,IAAIF,EACrB,CAEAf,gBAAAA,GACC,MAAMO,EAAUb,SAASc,cAA2B9B,KAAKF,QAAQO,iBAC7DwB,IACHA,EAAQX,aAAa,WAAY,MACjCW,EAAQW,MAAM,CAAEC,eAAe,IAEjC"}