{"version":3,"file":"index.umd.js","sources":["../node_modules/@swup/plugin/dist/index.modern.js","../node_modules/on-demand-live-region/on-demand-live-region.js","../node_modules/focus-options-polyfill/index.js","../src/index.ts"],"sourcesContent":["function r(){return r=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},r.apply(this,arguments)}const n=r=>String(r).split(\".\").map(r=>String(parseInt(r||\"0\",10))).concat([\"0\",\"0\"]).slice(0,3).join(\".\");class e{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(r=>r()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error(\"You must define a name of plugin when creating a class.\")}_afterUnmount(){}_checkRequirements(){return\"object\"!=typeof this.requires||Object.entries(this.requires).forEach(([r,e])=>{if(!function(r,e,t){const s=function(r,n){var e;if(\"swup\"===r)return null!=(e=n.version)?e:\"\";{var t;const e=n.findPlugin(r);return null!=(t=null==e?void 0:e.version)?t:\"\"}}(r,t);return!!s&&((r,e)=>e.every(e=>{const[,t,s]=e.match(/^([\\D]+)?(.*)$/)||[];var o,i;return((r,n)=>{const e={\"\":r=>0===r,\">\":r=>r>0,\">=\":r=>r>=0,\"<\":r=>r<0,\"<=\":r=>r<=0};return(e[n]||e[\"\"])(r)})((i=s,o=n(o=r),i=n(i),o.localeCompare(i,void 0,{numeric:!0})),t||\">=\")}))(s,e)}(r,e=Array.isArray(e)?e:[e],this.swup)){const n=`${r} ${e.join(\", \")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${n}`)}}),!0}on(r,n,e={}){var t;n=!(t=n).name.startsWith(\"bound \")||t.hasOwnProperty(\"prototype\")?n.bind(this):n;const s=this.swup.hooks.on(r,n,e);return this.handlersToUnregister.push(s),s}once(n,e,t={}){return this.on(n,e,r({},t,{once:!0}))}before(n,e,t={}){return this.on(n,e,r({},t,{before:!0}))}replace(n,e,t={}){return this.on(n,e,r({},t,{replace:!0}))}off(r,n){return this.swup.hooks.off(r,n)}}export{e as default};\n//# sourceMappingURL=index.modern.js.map\n","/* global define */\n\n(function (global) {\n  'use strict'\n\n  // Constructor\n  function OnDemandLiveRegion (options) {\n    options = options || {}\n\n    // The default settings for the module.\n    this.settings = {\n      level: 'polite',\n      parent: 'body',\n      idPrefix: 'live-region-',\n      delay: 0\n    }\n\n    // Overwrite defaults where they are provided in options\n    for (var setting in options) {\n      if (options.hasOwnProperty(setting)) {\n        this.settings[setting] = options[setting]\n      }\n    }\n\n    // Cast parent as DOM node\n    this.settings.parent = document.querySelector(this.settings.parent)\n  }\n\n  // 'Say' method\n  OnDemandLiveRegion.prototype.say = function (thingToSay, delay) {\n    // Get rid of old live region if it exists\n    var oldRegion = this.settings.parent.querySelector('[id^=\"' + this.settings.idPrefix + '\"]') || false\n    if (oldRegion) {\n      this.settings.parent.removeChild(oldRegion)\n    }\n\n    // Did an override level get set?\n    delay = delay || this.settings.delay\n\n    // Create fresh live region\n    this.currentRegion = document.createElement('span')\n    this.currentRegion.id = this.settings.idPrefix + Math.floor(Math.random() * 10000)\n\n    // Determine redundant role\n    var role = this.settings.level !== 'assertive' ? 'status' : 'alert'\n\n    // Add role and aria-live attribution\n    this.currentRegion.setAttribute('aria-live', this.settings.level)\n    this.currentRegion.setAttribute('role', role)\n\n    // Hide live region element, but not from assistive technologies\n    this.currentRegion.setAttribute('style', 'clip: rect(1px, 1px, 1px, 1px); height: 1px; overflow: hidden; position: absolute; white-space: nowrap; width: 1px')\n\n    // Add live region to its designated parent\n    this.settings.parent.appendChild(this.currentRegion)\n\n    // Populate live region to trigger it\n    window.setTimeout(function () {\n      this.currentRegion.textContent = thingToSay\n    }.bind(this), delay)\n\n    return this\n  }\n\n  // Export OnDemandLiveRegion\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = OnDemandLiveRegion\n  } else if (typeof define === 'function' && define.amd) {\n    define('OnDemandLiveRegion', [], function () {\n      return OnDemandLiveRegion\n    })\n  } else if (typeof global === 'object') {\n    // attach to window\n    global.OnDemandLiveRegion = OnDemandLiveRegion\n  }\n}(this))\n","// focus - focusOptions - preventScroll polyfill\n(function() {\n  if (\n    typeof window === \"undefined\" ||\n    typeof document === \"undefined\" ||\n    typeof HTMLElement === \"undefined\"\n  ) {\n    return;\n  }\n\n  var supportsPreventScrollOption = false;\n  try {\n    var focusElem = document.createElement(\"div\");\n    focusElem.addEventListener(\n      \"focus\",\n      function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n      },\n      true\n    );\n    focusElem.focus(\n      Object.defineProperty({}, \"preventScroll\", {\n        get: function() {\n          // Edge v18 gives a false positive for supporting inputs\n          if (\n            navigator &&\n            typeof navigator.userAgent !== 'undefined' &&\n            navigator.userAgent &&\n            navigator.userAgent.match(/Edge\\/1[7-8]/)) {\n              return supportsPreventScrollOption = false\n          }\n\n          supportsPreventScrollOption = true;\n        }\n      })\n    );\n  } catch (e) {}\n\n  if (\n    HTMLElement.prototype.nativeFocus === undefined &&\n    !supportsPreventScrollOption\n  ) {\n    HTMLElement.prototype.nativeFocus = HTMLElement.prototype.focus;\n\n    var calcScrollableElements = function(element) {\n      var parent = element.parentNode;\n      var scrollableElements = [];\n      var rootScrollingElement =\n        document.scrollingElement || document.documentElement;\n\n      while (parent && parent !== rootScrollingElement) {\n        if (\n          parent.offsetHeight < parent.scrollHeight ||\n          parent.offsetWidth < parent.scrollWidth\n        ) {\n          scrollableElements.push([\n            parent,\n            parent.scrollTop,\n            parent.scrollLeft\n          ]);\n        }\n        parent = parent.parentNode;\n      }\n      parent = rootScrollingElement;\n      scrollableElements.push([parent, parent.scrollTop, parent.scrollLeft]);\n\n      return scrollableElements;\n    };\n\n    var restoreScrollPosition = function(scrollableElements) {\n      for (var i = 0; i < scrollableElements.length; i++) {\n        scrollableElements[i][0].scrollTop = scrollableElements[i][1];\n        scrollableElements[i][0].scrollLeft = scrollableElements[i][2];\n      }\n      scrollableElements = [];\n    };\n\n    var patchedFocus = function(args) {\n      if (args && args.preventScroll) {\n        var evScrollableElements = calcScrollableElements(this);\n        if (typeof setTimeout === 'function') {\n          var thisElem = this;\n          setTimeout(function () {\n            thisElem.nativeFocus();\n            restoreScrollPosition(evScrollableElements);\n          }, 0);\n        } else {\n          this.nativeFocus();\n          restoreScrollPosition(evScrollableElements);\n        }\n      }\n      else {\n        this.nativeFocus();\n      }\n    };\n\n    HTMLElement.prototype.focus = patchedFocus;\n  }\n})();\n","import Plugin from '@swup/plugin';\nimport OnDemandLiveRegion from 'on-demand-live-region';\n\nimport 'focus-options-polyfill';\n\ntype Options = {\n\t/** The selector for matching the main content area of the page. */\n\tcontentSelector: string;\n\t/** The selector for finding headings inside the main content area. */\n\theadingSelector: string;\n\t/** How to announce the new page title. */\n\tannouncementTemplate: string;\n\t/** How to announce the new page url. Used as fallback if no heading was found. */\n\turlTemplate: string;\n};\n\nexport default class SwupA11yPlugin extends Plugin {\n\tname = 'SwupA11yPlugin';\n\n\trequires = { swup: '>=4' };\n\n\tdefaults: Options = {\n\t\tcontentSelector: 'main',\n\t\theadingSelector: 'h1, h2, [role=heading]',\n\t\tannouncementTemplate: 'Navigated to: {title}',\n\t\turlTemplate: 'New page at {url}'\n\t};\n\n\toptions: Options;\n\n\tliveRegion: OnDemandLiveRegion;\n\n\tconstructor(options: Partial<Options> = {}) {\n\t\tsuper();\n\t\tthis.options = { ...this.defaults, ...options };\n\t\tthis.liveRegion = new OnDemandLiveRegion();\n\t}\n\n\tmount() {\n\t\tthis.on('visit:start', this.markAsBusy);\n\t\tthis.on('visit:end', this.unmarkAsBusy);\n\t\tthis.on('content:replace', this.announceVisit);\n\t}\n\n\tmarkAsBusy() {\n\t\tdocument.documentElement.setAttribute('aria-busy', 'true');\n\t}\n\n\tunmarkAsBusy() {\n\t\tdocument.documentElement.removeAttribute('aria-busy');\n\t}\n\n\tannounceVisit() {\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.announcePageName();\n\t\t\tthis.focusPageContent();\n\t\t});\n\t}\n\n\tannouncePageName() {\n\t\tconst { contentSelector, headingSelector, urlTemplate, announcementTemplate } =\n\t\t\tthis.options;\n\n\t\t// Default: announce new /path/of/page.html\n\t\tlet pageName: string = urlTemplate.replace('{url}', window.location.pathname);\n\n\t\t// Check for title tag\n\t\tif (document.title) {\n\t\t\tpageName = document.title;\n\t\t}\n\n\t\t// Look for first heading in content container\n\t\tconst content = document.querySelector(contentSelector);\n\t\tif (content) {\n\t\t\tconst headings = content.querySelectorAll(headingSelector);\n\t\t\tif (headings && headings.length) {\n\t\t\t\tconst [heading] = headings;\n\t\t\t\tpageName = heading.getAttribute('aria-label') || heading.textContent || pageName;\n\t\t\t}\n\t\t}\n\n\t\tconst announcement = announcementTemplate.replace('{title}', pageName.trim());\n\t\tthis.liveRegion.say(announcement);\n\t}\n\n\tfocusPageContent() {\n\t\tconst content = document.querySelector<HTMLElement>(this.options.contentSelector);\n\t\tif (content) {\n\t\t\tcontent.setAttribute('tabindex', '-1');\n\t\t\tcontent.focus({ preventScroll: true });\n\t\t}\n\t}\n}\n"],"names":["n","r","String","split","map","parseInt","concat","slice","join","e","every","t","s","match","o","i","localeCompare","numeric","global","OnDemandLiveRegion","options","setting","this","settings","level","parent","idPrefix","delay","hasOwnProperty","document","querySelector","prototype","say","thingToSay","oldRegion","removeChild","currentRegion","createElement","id","Math","floor","random","role","setAttribute","appendChild","window","setTimeout","textContent","bind","module","HTMLElement","supportsPreventScrollOption","focusElem","addEventListener","event","preventDefault","stopPropagation","focus","Object","defineProperty","get","navigator","userAgent","undefined","nativeFocus","restoreScrollPosition","scrollableElements","length","scrollTop","scrollLeft","args","preventScroll","evScrollableElements","element","parentNode","rootScrollingElement","scrollingElement","documentElement","offsetHeight","scrollHeight","offsetWidth","scrollWidth","push","calcScrollableElements","thisElem","Plugin","constructor","super","name","requires","swup","defaults","contentSelector","headingSelector","announcementTemplate","urlTemplate","liveRegion","mount","on","markAsBusy","unmarkAsBusy","announceVisit","removeAttribute","requestAnimationFrame","announcePageName","focusPageContent","pageName","replace","location","pathname","title","content","headings","querySelectorAll","heading","getAttribute","announcement","trim"],"mappings":"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"}