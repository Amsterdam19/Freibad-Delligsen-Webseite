!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).SwupPreloadPlugin=t()}(this,function(){function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},e.apply(this,arguments)}const t=e=>String(e).split(".").map(e=>String(parseInt(e||"0",10))).concat(["0","0"]).slice(0,3).join(".");class r{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(e=>e()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([e,r])=>{if(!function(e,r,o){const s=function(e,t){var r;if("swup"===e)return null!=(r=t.version)?r:"";{var o;const r=t.findPlugin(e);return null!=(o=null==r?void 0:r.version)?o:""}}(e,o);return!!s&&((e,r)=>r.every(r=>{const[,o,s]=r.match(/^([\D]+)?(.*)$/)||[];var n,i;return((e,t)=>{const r={"":e=>0===e,">":e=>e>0,">=":e=>e>=0,"<":e=>e<0,"<=":e=>e<=0};return(r[t]||r[""])(e)})((i=s,n=t(n=e),i=t(i),n.localeCompare(i,void 0,{numeric:!0})),o||">=")}))(s,r)}(e,r=Array.isArray(r)?r:[r],this.swup)){const t=`${e} ${r.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${t}`)}}),!0}on(e,t,r={}){var o;t=!(o=t).name.startsWith("bound ")||o.hasOwnProperty("prototype")?t.bind(this):t;const s=this.swup.hooks.on(e,t,r);return this.handlersToUnregister.push(s),s}once(t,r,o={}){return this.on(t,r,e({},o,{once:!0}))}before(t,r,o={}){return this.on(t,r,e({},o,{before:!0}))}replace(t,r,o={}){return this.on(t,r,e({},o,{replace:!0}))}off(e,t){return this.swup.hooks.off(e,t)}}const o=({hash:e}={})=>location.pathname+location.search+(e?location.hash:"");class s extends URL{constructor(e,t=document.baseURI){super(e.toString(),t)}get url(){return this.pathname+this.search}static fromElement(e){const t=e.getAttribute("href")||e.getAttribute("xlink:href")||"";return new s(t)}static fromUrl(e){return new s(e)}}return class extends r{constructor(e){void 0===e&&(e={}),super();const t=this,r=this;this.name="SwupPreloadPlugin",this.requires={swup:">=4"},this.defaults={throttle:5,preloadInitialPage:!0},this.options=void 0,this.preloadPromises=new Map,this.mouseEnterDelegate=void 0,this.touchStartDelegate=void 0,this.onPageLoad=(e,t,r)=>{const{url:o}=e.to;return this.preloadPromises.has(o)?this.preloadPromises.get(o):r?.(e,t)},this.onMouseEnter=function(e){try{if(e.target!==e.delegateTarget)return Promise.resolve();if(!r.deviceSupportsHover())return Promise.resolve();const t=e.delegateTarget;return t instanceof HTMLAnchorElement?(r.swup.hooks.callSync("link:hover",{el:t,event:e}),r.preloadLink(t),Promise.resolve()):Promise.resolve()}catch(e){return Promise.reject(e)}},this.onTouchStart=e=>{if(this.deviceSupportsHover())return;const t=e.delegateTarget;t instanceof HTMLAnchorElement&&this.preloadLink(t)},this.preload=function(e){try{return Promise.resolve(t.swup.fetchPage(e)).then(function(e){return Promise.resolve(t.swup.hooks.call("page:preload",{page:e})).then(function(){return e})})}catch(e){return Promise.reject(e)}},this.preloadLinks=()=>{document.querySelectorAll("a[data-swup-preload], [data-swup-preload-all] a").forEach(e=>{this.swup.shouldIgnoreVisit(e.href,{el:e})||this.swup.preload?.(e.href)})},this.options={...this.defaults,...e}}mount(){const e=this.swup;e.options.cache?(e.hooks.create("page:preload"),e.hooks.create("link:hover"),e.preload=this.preload,e.preloadLinks=this.preloadLinks,this.mouseEnterDelegate=e.delegateEvent(e.options.linkSelector,"mouseenter",this.onMouseEnter.bind(this),{capture:!0}),this.touchStartDelegate=e.delegateEvent(e.options.linkSelector,"touchstart",this.onTouchStart.bind(this),{capture:!0}),this.on("page:view",this.onPageView),this.replace("page:load",this.onPageLoad),this.preloadLinks(),this.options.preloadInitialPage&&this.preload(o())):console.warn("SwupPreloadPlugin: swup cache needs to be enabled for preloading")}unmount(){this.swup.preload=void 0,this.swup.preloadLinks=void 0,this.preloadPromises.clear(),this.mouseEnterDelegate?.destroy(),this.touchStartDelegate?.destroy()}onPageView(){this.preloadLinks()}deviceSupportsHover(){return window.matchMedia("(hover: hover)").matches}preloadLink(e){const{url:t,href:r}=s.fromElement(e);if(this.swup.shouldIgnoreVisit(r,{el:e}))return;if(t===o())return;if(this.swup.cache.has(t))return;if(this.preloadPromises.has(t))return;if(this.preloadPromises.size>=this.options.throttle)return;const n=this.preload(t);n.catch(()=>{}).finally(()=>{this.preloadPromises.delete(t)}),this.preloadPromises.set(t,n)}}});
//# sourceMappingURL=index.umd.js.map
