var e=require("@swup/plugin"),t=require("swup");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/r(e);module.exports=class extends o.default{constructor(e){void 0===e&&(e={}),super();const t=this,r=this;this.name="SwupPreloadPlugin",this.requires={swup:">=4"},this.defaults={throttle:5,preloadInitialPage:!0},this.options=void 0,this.preloadPromises=new Map,this.mouseEnterDelegate=void 0,this.touchStartDelegate=void 0,this.onPageLoad=(e,t,r)=>{const{url:o}=e.to;return this.preloadPromises.has(o)?this.preloadPromises.get(o):r?.(e,t)},this.onMouseEnter=function(e){try{if(e.target!==e.delegateTarget)return Promise.resolve();if(!r.deviceSupportsHover())return Promise.resolve();const t=e.delegateTarget;return t instanceof HTMLAnchorElement?(r.swup.hooks.callSync("link:hover",{el:t,event:e}),r.preloadLink(t),Promise.resolve()):Promise.resolve()}catch(e){return Promise.reject(e)}},this.onTouchStart=e=>{if(this.deviceSupportsHover())return;const t=e.delegateTarget;t instanceof HTMLAnchorElement&&this.preloadLink(t)},this.preload=function(e){try{return Promise.resolve(t.swup.fetchPage(e)).then(function(e){return Promise.resolve(t.swup.hooks.call("page:preload",{page:e})).then(function(){return e})})}catch(e){return Promise.reject(e)}},this.preloadLinks=()=>{document.querySelectorAll("a[data-swup-preload], [data-swup-preload-all] a").forEach(e=>{this.swup.shouldIgnoreVisit(e.href,{el:e})||this.swup.preload?.(e.href)})},this.options={...this.defaults,...e}}mount(){const e=this.swup;e.options.cache?(e.hooks.create("page:preload"),e.hooks.create("link:hover"),e.preload=this.preload,e.preloadLinks=this.preloadLinks,this.mouseEnterDelegate=e.delegateEvent(e.options.linkSelector,"mouseenter",this.onMouseEnter.bind(this),{capture:!0}),this.touchStartDelegate=e.delegateEvent(e.options.linkSelector,"touchstart",this.onTouchStart.bind(this),{capture:!0}),this.on("page:view",this.onPageView),this.replace("page:load",this.onPageLoad),this.preloadLinks(),this.options.preloadInitialPage&&this.preload(t.getCurrentUrl())):console.warn("SwupPreloadPlugin: swup cache needs to be enabled for preloading")}unmount(){this.swup.preload=void 0,this.swup.preloadLinks=void 0,this.preloadPromises.clear(),this.mouseEnterDelegate?.destroy(),this.touchStartDelegate?.destroy()}onPageView(){this.preloadLinks()}deviceSupportsHover(){return window.matchMedia("(hover: hover)").matches}preloadLink(e){const{url:r,href:o}=t.Location.fromElement(e);if(this.swup.shouldIgnoreVisit(o,{el:e}))return;if(r===t.getCurrentUrl())return;if(this.swup.cache.has(r))return;if(this.preloadPromises.has(r))return;if(this.preloadPromises.size>=this.options.throttle)return;const s=this.preload(r);s.catch(()=>{}).finally(()=>{this.preloadPromises.delete(r)}),this.preloadPromises.set(r,s)}};
//# sourceMappingURL=index.cjs.map
