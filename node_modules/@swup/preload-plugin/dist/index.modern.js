import e from"@swup/plugin";import{getCurrentUrl as t,Location as o}from"swup";function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},s.apply(this,arguments)}class r extends e{constructor(e={}){var t;super(),t=this,this.name="SwupPreloadPlugin",this.requires={swup:">=4"},this.defaults={throttle:5,preloadInitialPage:!0},this.options=void 0,this.preloadPromises=new Map,this.mouseEnterDelegate=void 0,this.touchStartDelegate=void 0,this.onPageLoad=(e,t,o)=>{const{url:s}=e.to;return this.preloadPromises.has(s)?this.preloadPromises.get(s):null==o?void 0:o(e,t)},this.onMouseEnter=async function(e){if(e.target!==e.delegateTarget)return;if(!t.deviceSupportsHover())return;const o=e.delegateTarget;o instanceof HTMLAnchorElement&&(t.swup.hooks.callSync("link:hover",{el:o,event:e}),t.preloadLink(o))},this.onTouchStart=e=>{if(this.deviceSupportsHover())return;const t=e.delegateTarget;t instanceof HTMLAnchorElement&&this.preloadLink(t)},this.preload=async function(e){const o=await t.swup.fetchPage(e);return await t.swup.hooks.call("page:preload",{page:o}),o},this.preloadLinks=()=>{document.querySelectorAll("a[data-swup-preload], [data-swup-preload-all] a").forEach(e=>{var t,o;this.swup.shouldIgnoreVisit(e.href,{el:e})||null==(t=(o=this.swup).preload)||t.call(o,e.href)})},this.options=s({},this.defaults,e)}mount(){const e=this.swup;e.options.cache?(e.hooks.create("page:preload"),e.hooks.create("link:hover"),e.preload=this.preload,e.preloadLinks=this.preloadLinks,this.mouseEnterDelegate=e.delegateEvent(e.options.linkSelector,"mouseenter",this.onMouseEnter.bind(this),{capture:!0}),this.touchStartDelegate=e.delegateEvent(e.options.linkSelector,"touchstart",this.onTouchStart.bind(this),{capture:!0}),this.on("page:view",this.onPageView),this.replace("page:load",this.onPageLoad),this.preloadLinks(),this.options.preloadInitialPage&&this.preload(t())):console.warn("SwupPreloadPlugin: swup cache needs to be enabled for preloading")}unmount(){var e,t;this.swup.preload=void 0,this.swup.preloadLinks=void 0,this.preloadPromises.clear(),null==(e=this.mouseEnterDelegate)||e.destroy(),null==(t=this.touchStartDelegate)||t.destroy()}onPageView(){this.preloadLinks()}deviceSupportsHover(){return window.matchMedia("(hover: hover)").matches}preloadLink(e){const{url:s,href:r}=o.fromElement(e);if(this.swup.shouldIgnoreVisit(r,{el:e}))return;if(s===t())return;if(this.swup.cache.has(s))return;if(this.preloadPromises.has(s))return;if(this.preloadPromises.size>=this.options.throttle)return;const i=this.preload(s);i.catch(()=>{}).finally(()=>{this.preloadPromises.delete(s)}),this.preloadPromises.set(s,i)}}export{r as default};
//# sourceMappingURL=index.modern.js.map
