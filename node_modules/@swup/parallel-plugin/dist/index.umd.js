!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t||self).SwupParallelPlugin=i()}(this,function(){function t(){return t=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},t.apply(this,arguments)}const i=t=>String(t).split(".").map(t=>String(parseInt(t||"0",10))).concat(["0","0"]).slice(0,3).join(".");class n{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(t=>t()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([t,n])=>{if(!function(t,n,e){const s=function(t,i){var n;if("swup"===t)return null!=(n=i.version)?n:"";{var e;const n=i.findPlugin(t);return null!=(e=null==n?void 0:n.version)?e:""}}(t,e);return!!s&&((t,n)=>n.every(n=>{const[,e,s]=n.match(/^([\D]+)?(.*)$/)||[];var r,o;return((t,i)=>{const n={"":t=>0===t,">":t=>t>0,">=":t=>t>=0,"<":t=>t<0,"<=":t=>t<=0};return(n[i]||n[""])(t)})((o=s,r=i(r=t),o=i(o),r.localeCompare(o,void 0,{numeric:!0})),e||">=")}))(s,n)}(t,n=Array.isArray(n)?n:[n],this.swup)){const i=`${t} ${n.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${i}`)}}),!0}on(t,i,n={}){var e;i=!(e=i).name.startsWith("bound ")||e.hasOwnProperty("prototype")?i.bind(this):i;const s=this.swup.hooks.on(t,i,n);return this.handlersToUnregister.push(s),s}once(i,n,e={}){return this.on(i,n,t({},e,{once:!0}))}before(i,n,e={}){return this.on(i,n,t({},e,{before:!0}))}replace(i,n,e={}){return this.on(i,n,t({},e,{replace:!0}))}off(t,i){return this.swup.hooks.off(t,i)}}return class extends n{constructor(t){void 0===t&&(t={}),super(),this.name="SwupParallelPlugin",this.requires={swup:">=4"},this.defaults={containers:[]},this.options=void 0,this.originalContainers=null,this.previousContainers=[],this.nextContainers=[],this.startVisit=t=>{this.originalContainers=null,this.visitHasPotentialParallelAnimation(t)&&(t.animation.wait=!0,t.animation.parallel=!0)},this.skipOutAnimation=(t,i)=>{this.isParallelVisit(t)&&(i.skip=!0)},this.insertContainers=(t,i)=>{let{page:n}=i;if(!this.isParallelVisit(t))return;const e=this.getContainersForVisit(t,n),s=e.map(t=>{let{selector:i}=t;return i});e.forEach(t=>{let{previous:i,next:n}=t;this.previousContainers.push(i),this.nextContainers.push(n),i.setAttribute("aria-hidden","true"),i.before(n),n.classList.add("is-next-container"),i.classList.add("is-previous-container"),n.classList.remove("is-next-container")}),this.originalContainers=t.containers,t.containers=t.containers.filter(t=>!s.includes(t))},this.resetContainers=t=>{this.originalContainers&&(t.containers=this.originalContainers)},this.cleanupContainers=()=>{this.previousContainers.forEach(t=>t.remove()),this.nextContainers.forEach(t=>t.classList.remove("is-next-container")),this.previousContainers=[],this.nextContainers=[]},this.options={...this.defaults,...t}}mount(){this.options.containers.length||(this.options.containers=this.swup.options.containers),this.on("visit:start",this.startVisit,{priority:1}),this.before("animation:out:await",this.skipOutAnimation,{priority:1}),this.before("content:replace",this.insertContainers,{priority:1}),this.on("content:replace",this.resetContainers),this.on("visit:end",this.cleanupContainers)}getContainersForVisit(t,i){let{html:n}=i;const{containers:e}=this.options,s=e.filter(i=>t.containers.includes(i));if(!s.length)return console.warn("No parallel containers found in list of replaced containers"),[];const r=(new DOMParser).parseFromString(n,"text/html");return s.reduce((t,i)=>{const n=document.querySelector(i),e=r.querySelector(i);return n&&e?[...t,{selector:i,previous:n,next:e}]:t},[])}isParallelVisit(t){return t.animation.animate&&t.animation.parallel}markVisitAsParallelAnimation(t){t.animation.wait=!0,t.animation.parallel=!0}visitHasPotentialParallelAnimation(t){return t.animation.animate&&!1!==t.animation.parallel&&this.visitHasParallelContainers(t)}visitHasParallelContainers(t){return this.options.containers.some(i=>{const n=document.querySelector(i);return n?.matches(t.containers.join(","))})}}});
//# sourceMappingURL=index.umd.js.map
