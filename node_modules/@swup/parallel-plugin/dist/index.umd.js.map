{"version":3,"file":"index.umd.js","sources":["../node_modules/@swup/plugin/dist/index.modern.js","../src/index.ts"],"sourcesContent":["function r(){return r=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},r.apply(this,arguments)}const n=r=>String(r).split(\".\").map(r=>String(parseInt(r||\"0\",10))).concat([\"0\",\"0\"]).slice(0,3).join(\".\");class e{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(r=>r()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error(\"You must define a name of plugin when creating a class.\")}_afterUnmount(){}_checkRequirements(){return\"object\"!=typeof this.requires||Object.entries(this.requires).forEach(([r,e])=>{if(!function(r,e,t){const s=function(r,n){var e;if(\"swup\"===r)return null!=(e=n.version)?e:\"\";{var t;const e=n.findPlugin(r);return null!=(t=null==e?void 0:e.version)?t:\"\"}}(r,t);return!!s&&((r,e)=>e.every(e=>{const[,t,s]=e.match(/^([\\D]+)?(.*)$/)||[];var o,i;return((r,n)=>{const e={\"\":r=>0===r,\">\":r=>r>0,\">=\":r=>r>=0,\"<\":r=>r<0,\"<=\":r=>r<=0};return(e[n]||e[\"\"])(r)})((i=s,o=n(o=r),i=n(i),o.localeCompare(i,void 0,{numeric:!0})),t||\">=\")}))(s,e)}(r,e=Array.isArray(e)?e:[e],this.swup)){const n=`${r} ${e.join(\", \")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${n}`)}}),!0}on(r,n,e={}){var t;n=!(t=n).name.startsWith(\"bound \")||t.hasOwnProperty(\"prototype\")?n.bind(this):n;const s=this.swup.hooks.on(r,n,e);return this.handlersToUnregister.push(s),s}once(n,e,t={}){return this.on(n,e,r({},t,{once:!0}))}before(n,e,t={}){return this.on(n,e,r({},t,{before:!0}))}replace(n,e,t={}){return this.on(n,e,r({},t,{replace:!0}))}off(r,n){return this.swup.hooks.off(r,n)}}export{e as default};\n//# sourceMappingURL=index.modern.js.map\n","import type { Handler, Visit } from 'swup';\nimport { forceReflow } from 'swup';\nimport Plugin from '@swup/plugin';\n\ndeclare module 'swup' {\n\texport interface VisitAnimation {\n\t\t/** Parallel visit: run in and out animation at the same time */\n\t\tparallel?: boolean;\n\t}\n}\n\ntype PluginOptions = {\n\tcontainers: string[];\n};\n\ntype ContainerSet = {\n\tselector: string;\n\tprevious: HTMLElement;\n\tnext: HTMLElement;\n};\n\nexport default class SwupParallelPlugin extends Plugin {\n\tname = 'SwupParallelPlugin';\n\n\trequires = { swup: '>=4' };\n\n\tdefaults: PluginOptions = { containers: [] };\n\toptions: PluginOptions;\n\n\toriginalContainers: string[] | null = null;\n\tpreviousContainers: Element[] = [];\n\tnextContainers: Element[] = [];\n\n\tconstructor(options: Partial<PluginOptions> = {}) {\n\t\tsuper();\n\t\tthis.options = { ...this.defaults, ...options };\n\t}\n\n\tmount() {\n\t\t// No containers passed? Use all content containers\n\t\tif (!this.options.containers.length) {\n\t\t\tthis.options.containers = this.swup.options.containers;\n\t\t}\n\n\t\t// On visit: check for containers and mark as parallel visit\n\t\t// Run after user hooks to allow disabling parallel animations beforehand\n\t\tthis.on('visit:start', this.startVisit, { priority: 1 });\n\t\t// Before awaiting out animation: skip\n\t\tthis.before('animation:out:await', this.skipOutAnimation, { priority: 1 });\n\t\t// Before content replace: insert new containers\n\t\tthis.before('content:replace', this.insertContainers, { priority: 1 });\n\t\t// After content replace: reset containers\n\t\tthis.on('content:replace', this.resetContainers);\n\t\t// After visit: remove old containers\n\t\tthis.on('visit:end', this.cleanupContainers);\n\t}\n\n\tstartVisit: Handler<'visit:start'> = (visit) => {\n\t\tthis.originalContainers = null;\n\n\t\t// Only mark as parallel visit if containers found and animation matches\n\t\tif (this.visitHasPotentialParallelAnimation(visit)) {\n\t\t\tvisit.animation.wait = true;\n\t\t\tvisit.animation.parallel = true;\n\t\t}\n\t};\n\n\tskipOutAnimation: Handler<'animation:out:await'> = (visit, args) => {\n\t\tif (this.isParallelVisit(visit)) {\n\t\t\targs.skip = true;\n\t\t}\n\t};\n\n\tinsertContainers: Handler<'content:replace'> = (visit, { page }) => {\n\t\tif (!this.isParallelVisit(visit)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Replace parallel containers ourselves\n\t\tconst containerSets = this.getContainersForVisit(visit, page);\n\t\tconst parallelContainers = containerSets.map(({ selector }) => selector);\n\t\tcontainerSets.forEach(({ previous, next }) => {\n\t\t\tthis.previousContainers.push(previous);\n\t\t\tthis.nextContainers.push(next);\n\n\t\t\tprevious.setAttribute('aria-hidden', 'true');\n\t\t\tprevious.before(next);\n\n\t\t\tnext.classList.add('is-next-container');\n\t\t\tforceReflow(next);\n\t\t\tprevious.classList.add('is-previous-container');\n\t\t\tnext.classList.remove('is-next-container');\n\t\t});\n\n\t\t// Hand all other non-parallel containers to swup\n\t\tthis.originalContainers = visit.containers;\n\t\tvisit.containers = visit.containers.filter((s) => !parallelContainers.includes(s));\n\t};\n\n\tresetContainers: Handler<'content:replace'> = (visit) => {\n\t\tif (this.originalContainers) {\n\t\t\tvisit.containers = this.originalContainers;\n\t\t}\n\t};\n\n\tcleanupContainers = () => {\n\t\tthis.previousContainers.forEach((c) => c.remove());\n\t\tthis.nextContainers.forEach((c) => c.classList.remove('is-next-container'));\n\t\tthis.previousContainers = [];\n\t\tthis.nextContainers = [];\n\t};\n\n\tgetContainersForVisit(visit: Visit, { html }: { html: string }): ContainerSet[] {\n\t\tconst { containers: parallelContainers } = this.options;\n\t\tconst containersInVisit = parallelContainers.filter((s) => visit.containers.includes(s));\n\t\tif (!containersInVisit.length) {\n\t\t\tconsole.warn('No parallel containers found in list of replaced containers');\n\t\t\treturn [];\n\t\t}\n\n\t\tconst incomingDocument = new DOMParser().parseFromString(html, 'text/html');\n\n\t\treturn containersInVisit.reduce((containers, selector: string) => {\n\t\t\tconst previous = document.querySelector<HTMLElement>(selector);\n\t\t\tconst next = incomingDocument.querySelector<HTMLElement>(selector);\n\t\t\treturn previous && next ? [...containers, { selector, previous, next }] : containers;\n\t\t}, [] as ContainerSet[]);\n\t}\n\n\tisParallelVisit(visit: Visit) {\n\t\treturn visit.animation.animate && visit.animation.parallel;\n\t}\n\n\tmarkVisitAsParallelAnimation(visit: Visit) {\n\t\tvisit.animation.wait = true;\n\t\tvisit.animation.parallel = true;\n\t}\n\n\tvisitHasPotentialParallelAnimation(visit: Visit) {\n\t\t// Checking for visit.animation.parallel !== false here allows explicitly\n\t\t// disabling parallel animations in user hooks before this plugin executes\n\t\treturn (\n\t\t\tvisit.animation.animate &&\n\t\t\tvisit.animation.parallel !== false &&\n\t\t\tthis.visitHasParallelContainers(visit)\n\t\t);\n\t}\n\n\tvisitHasParallelContainers(visit: Visit) {\n\t\treturn this.options.containers.some((selector) => {\n\t\t\tconst container = document.querySelector(selector);\n\t\t\treturn container?.matches(visit.containers.join(','));\n\t\t});\n\t}\n}\n"],"names":["n","r","String","split","map","parseInt","concat","slice","join","e","every","t","s","match","o","i","localeCompare","numeric","Plugin","constructor","options","super","this","name","requires","swup","defaults","containers","originalContainers","previousContainers","nextContainers","startVisit","visit","visitHasPotentialParallelAnimation","animation","wait","parallel","skipOutAnimation","args","isParallelVisit","skip","insertContainers","_ref","page","containerSets","getContainersForVisit","parallelContainers","_ref2","selector","forEach","_ref3","previous","next","push","setAttribute","before","classList","add","remove","filter","includes","resetContainers","cleanupContainers","c","mount","length","on","priority","_ref4","html","containersInVisit","console","warn","incomingDocument","DOMParser","parseFromString","reduce","document","querySelector","animate","markVisitAsParallelAnimation","visitHasParallelContainers","some","container","matches"],"mappings":"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"}