var t=require("swup");function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=/*#__PURE__*/i(require("@swup/plugin"));module.exports=class extends n.default{constructor(i){void 0===i&&(i={}),super(),this.name="SwupParallelPlugin",this.requires={swup:">=4"},this.defaults={containers:[]},this.options=void 0,this.originalContainers=null,this.previousContainers=[],this.nextContainers=[],this.startVisit=t=>{this.originalContainers=null,this.visitHasPotentialParallelAnimation(t)&&(t.animation.wait=!0,t.animation.parallel=!0)},this.skipOutAnimation=(t,i)=>{this.isParallelVisit(t)&&(i.skip=!0)},this.insertContainers=(i,n)=>{let{page:e}=n;if(!this.isParallelVisit(i))return;const s=this.getContainersForVisit(i,e),r=s.map(t=>{let{selector:i}=t;return i});s.forEach(i=>{let{previous:n,next:e}=i;this.previousContainers.push(n),this.nextContainers.push(e),n.setAttribute("aria-hidden","true"),n.before(e),e.classList.add("is-next-container"),t.forceReflow(e),n.classList.add("is-previous-container"),e.classList.remove("is-next-container")}),this.originalContainers=i.containers,i.containers=i.containers.filter(t=>!r.includes(t))},this.resetContainers=t=>{this.originalContainers&&(t.containers=this.originalContainers)},this.cleanupContainers=()=>{this.previousContainers.forEach(t=>t.remove()),this.nextContainers.forEach(t=>t.classList.remove("is-next-container")),this.previousContainers=[],this.nextContainers=[]},this.options={...this.defaults,...i}}mount(){this.options.containers.length||(this.options.containers=this.swup.options.containers),this.on("visit:start",this.startVisit,{priority:1}),this.before("animation:out:await",this.skipOutAnimation,{priority:1}),this.before("content:replace",this.insertContainers,{priority:1}),this.on("content:replace",this.resetContainers),this.on("visit:end",this.cleanupContainers)}getContainersForVisit(t,i){let{html:n}=i;const{containers:e}=this.options,s=e.filter(i=>t.containers.includes(i));if(!s.length)return console.warn("No parallel containers found in list of replaced containers"),[];const r=(new DOMParser).parseFromString(n,"text/html");return s.reduce((t,i)=>{const n=document.querySelector(i),e=r.querySelector(i);return n&&e?[...t,{selector:i,previous:n,next:e}]:t},[])}isParallelVisit(t){return t.animation.animate&&t.animation.parallel}markVisitAsParallelAnimation(t){t.animation.wait=!0,t.animation.parallel=!0}visitHasPotentialParallelAnimation(t){return t.animation.animate&&!1!==t.animation.parallel&&this.visitHasParallelContainers(t)}visitHasParallelContainers(t){return this.options.containers.some(i=>{const n=document.querySelector(i);return n?.matches(t.containers.join(","))})}};
//# sourceMappingURL=index.cjs.map
