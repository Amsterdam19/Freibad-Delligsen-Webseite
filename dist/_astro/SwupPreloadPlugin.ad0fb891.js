import{e as h}from"./index.modern.d96712a8.js";import{n as l,l as p}from"./Swup.33d05aac.js";function a(){return a=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(i[t]=s[t])}return i},a.apply(this,arguments)}class c extends h{constructor(e={}){var s;super(),s=this,this.name="SwupPreloadPlugin",this.requires={swup:">=4"},this.defaults={throttle:5,preloadInitialPage:!0},this.options=void 0,this.preloadPromises=new Map,this.mouseEnterDelegate=void 0,this.touchStartDelegate=void 0,this.onPageLoad=(t,o,r)=>{const{url:n}=t.to;return this.preloadPromises.has(n)?this.preloadPromises.get(n):r?.(t,o)},this.onMouseEnter=async function(t){if(t.target!==t.delegateTarget||!s.deviceSupportsHover())return;const o=t.delegateTarget;o instanceof HTMLAnchorElement&&(s.swup.hooks.callSync("link:hover",{el:o,event:t}),s.preloadLink(o))},this.onTouchStart=t=>{if(this.deviceSupportsHover())return;const o=t.delegateTarget;o instanceof HTMLAnchorElement&&this.preloadLink(o)},this.preload=async function(t){const o=await s.swup.fetchPage(t);return await s.swup.hooks.call("page:preload",{page:o}),o},this.preloadLinks=()=>{document.querySelectorAll("a[data-swup-preload], [data-swup-preload-all] a").forEach(t=>{var o,r;this.swup.shouldIgnoreVisit(t.href,{el:t})||(o=(r=this.swup).preload)==null||o.call(r,t.href)})},this.options=a({},this.defaults,e)}mount(){const e=this.swup;e.options.cache?(e.hooks.create("page:preload"),e.hooks.create("link:hover"),e.preload=this.preload,e.preloadLinks=this.preloadLinks,this.mouseEnterDelegate=e.delegateEvent(e.options.linkSelector,"mouseenter",this.onMouseEnter.bind(this),{capture:!0}),this.touchStartDelegate=e.delegateEvent(e.options.linkSelector,"touchstart",this.onTouchStart.bind(this),{capture:!0}),this.on("page:view",this.onPageView),this.replace("page:load",this.onPageLoad),this.preloadLinks(),this.options.preloadInitialPage&&this.preload(l())):console.warn("SwupPreloadPlugin: swup cache needs to be enabled for preloading")}unmount(){var e,s;this.swup.preload=void 0,this.swup.preloadLinks=void 0,this.preloadPromises.clear(),(e=this.mouseEnterDelegate)==null||e.destroy(),(s=this.touchStartDelegate)==null||s.destroy()}onPageView(){this.preloadLinks()}deviceSupportsHover(){return window.matchMedia("(hover: hover)").matches}preloadLink(e){const{url:s,href:t}=p.fromElement(e);if(this.swup.shouldIgnoreVisit(t,{el:e})||s===l()||this.swup.cache.has(s)||this.preloadPromises.has(s)||this.preloadPromises.size>=this.options.throttle)return;const o=this.preload(s);o.catch(()=>{}).finally(()=>{this.preloadPromises.delete(s)}),this.preloadPromises.set(s,o)}}export{c as default};
